<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>FancyToastOsu! — Daily Scores</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div id="container">
  <header>
    <h1>FancyToastOsu! — osu! Iraq Daily Scores</h1>
    <small id="lastUpdated">Last updated: --</small>
  </header>

  <div id="mainContent">
    <aside id="calendarSection">
      <h2>Previous Days</h2>
      <div id="calendar"></div>
    </aside>

    <section id="todayScores">
      <h2>Scores</h2>
      <div id="scoresList">Loading...</div>
    </section>
  </div>

  <footer>
    Data powered by osu! API v2 • Archived daily
  </footer>
</div>

<script>
const BASE_PATH = '/OsuIraqRecentScores';

// Utility: format ISO date to YYYY-MM-DD
function formatDate(d){return d.toISOString().split('T')[0];}

// Load index.json
function loadIndex() {
  fetch(`${BASE_PATH}/data/index.json`).then(r=>r.json()).then(idx=>{
    const calendar = document.getElementById('calendar');
    calendar.innerHTML = '';

    if(!idx.available_dates || idx.available_dates.length===0){
      calendar.textContent = "No archived dates yet.";
      document.getElementById('scoresList').textContent = "No scores available.";
      return;
    }

    // Sort descending (newest first)
    idx.available_dates.sort((a,b)=>b.localeCompare(a));

    // Build calendar buttons
    idx.available_dates.forEach(date=>{
      const btn = document.createElement('button');
      btn.textContent = date;
      btn.onclick = ()=>loadDate(date);
      calendar.appendChild(btn);
    });

    // Load today automatically if exists
    const today = formatDate(new Date());
    if(idx.available_dates.includes(today)) loadDate(today);
    else loadDate(idx.available_dates[0]); // fallback to latest
  });
}

// Load scores for a given date
function loadDate(date){
  const [year, month, day] = date.split('-');
  fetch(`${BASE_PATH}/data/${year}/${month}/${day}.json`)
    .then(r=>r.json())
    .then(data=>{
      document.getElementById('lastUpdated').textContent = 'Last updated: ' + data.generated_at;
      const container = document.getElementById('scoresList');
      container.innerHTML = '';

      if(!data.scores || data.scores.length===0){
        container.textContent = 'No scores for this day.';
        return;
      }

      data.scores.forEach(s=>{
        const div = document.createElement('div');
        div.className = 'score';
        div.innerHTML = `
          <div class="cover"><img src="${s.beatmapset.cover}" alt="map cover"></div>
          <div class="info">
            <div class="player">${s.user} (${s.country})</div>
            <div class="meta">
              Rank: ${s.rank} | Acc: ${(s.accuracy*100).toFixed(2)}% | Combo: ${s.combo}x | Mods: ${s.mods.join(', ') || "None"} | ${s.pp || "N/A"}pp
            </div>
            <div class="mapTitle">${s.beatmapset.title}</div>
            <div class="time">Submitted: ${new Date(s.created_at).toLocaleString()}</div>
          </div>
        `;
        container.appendChild(div);
      });
    })
    .catch(err=>{
      console.error("Failed to load JSON:", err);
      document.getElementById('scoresList').textContent = "Failed to load scores.";
    });
}

// Initialize
loadIndex();
</script>
</body>
</html>
