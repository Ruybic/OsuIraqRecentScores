<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>FancyToastOsu! — Calendar Archive</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div id="container">
  <header>
    <h1>FancyToastOsu! — osu! Iraq Daily Scores</h1>
    <small id="lastUpdated">Last updated: --</small>
  </header>

  <section id="calendarSection">
    <h2>Calendar</h2>
    <div id="calendar"></div>
  </section>

  <section id="scoresSection">
    <h2>Scores for <span id="selectedDate">--</span></h2>
    <div id="scoresList">Select a day to view scores</div>
  </section>

  <footer>
    Data powered by osu! API v2 • Archived daily
  </footer>
</div>

<script>
const BASE_PATH = '/OsuIraqRecentScores';

// Utility: format YYYY-MM-DD
function formatDate(d){return d.toISOString().split('T')[0];}

// Load index.json
async function loadIndex() {
  try {
    const res = await fetch(`${BASE_PATH}/data/index.json`);
    const idx = await res.json();

    if(!idx.available_dates || idx.available_dates.length===0){
      document.getElementById('calendar').textContent = "No archived dates yet.";
      return;
    }

    buildCalendar(idx.available_dates);
  } catch(e){
    console.error("Failed to load index.json:", e);
    document.getElementById('calendar').textContent = "Error loading calendar";
  }
}

// Build a simple clickable calendar
function buildCalendar(dates){
  const calendar = document.getElementById('calendar');
  calendar.innerHTML = '';

  const today = formatDate(new Date());

  dates.sort().forEach(date => {
    const btn = document.createElement('button');
    btn.textContent = date;
    btn.className = (date === today) ? 'today' : '';
    btn.onclick = () => loadScores(date);
    calendar.appendChild(btn);
  });

  // Auto-load today if exists
  if(dates.includes(today)) loadScores(today);
  else loadScores(dates[dates.length-1]); // fallback latest
}

// Load scores for selected day
async function loadScores(date){
  const [year, month, day] = date.split('-');
  document.getElementById('selectedDate').textContent = date;
  const container = document.getElementById('scoresList');
  container.textContent = "Loading...";

  try {
    const res = await fetch(`${BASE_PATH}/data/${year}/${month}/${day}.json`);
    if(!res.ok) throw new Error("JSON not found for this day");
    const data = await res.json();

    container.innerHTML = '';

    if(!data.scores || data.scores.length===0){
      container.textContent = "No scores for this day.";
      return;
    }

    data.scores.forEach(s => {
      const div = document.createElement('div');
      div.className = 'score';
      div.innerHTML = `
        <div class="cover"><img src="${s.beatmapset.cover}" alt="map cover"></div>
        <div class="info">
          <div class="player">${s.user} (${s.country})</div>
          <div class="meta">
            Rank: ${s.rank} | Acc: ${(s.accuracy*100).toFixed(2)}% | Combo: ${s.combo}x | Mods: ${s.mods.join(', ') || "None"} | ${s.pp || "N/A"}pp
          </div>
          <div class="mapTitle">${s.beatmapset.title}</div>
          <div class="time">Submitted: ${new Date(s.created_at).toLocaleString()}</div>
        </div>
      `;
      container.appendChild(div);
    });

    document.getElementById('lastUpdated').textContent = 'Last updated: ' + data.generated_at;

  } catch(e){
    container.textContent = "No scores for this day.";
  }
}

// Initialize
loadIndex();
</script>
</body>
</html>
